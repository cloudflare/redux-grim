!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t["redux-grim"]={})}(this,function(t){"use strict";function e(t,e){t.on=function(r,n){if(!r in e)throw"invalid hook "+r;var i=e[r];return e[r]=i?function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];return n.apply(void 0,[i.apply(void 0,[t].concat(r))].concat(r))}:n,t}}var r=function(t){return t+".start"},n=function(t){return t+".success"},i=function(t){return t+".error"},o=function(t){return t+".set"},a=function(t){return t.endsWith(".success")},u=function(t){return t.endsWith(".set")},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,r){return function n(i,o){try{var a=e[i](o),u=a.value}catch(t){return void r(t)}if(!a.done)return Promise.resolve(u).then(function(t){n("next",t)},function(t){n("throw",t)});t(u)}("next")})}},f=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t},l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},p=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},d=["put","patch","post"],h=/\(([^)]+)\)/g,v=/\[([^)]+)\]/g,m={start:function(t,e,r,n){return t},success:function(t,e,r,n){return t},error:function(t,e,r,n){return t},all:function(t,e,r,n){return t}},b={apiFetch:function(t,e,r){return fetch(e,{method:t.toUpperCase(),body:JSON.stringify(r)})}};function g(t,e){for(var r=new Set,n=void 0;n=h.exec(e);){var i=n[1],o=i.indexOf(".");r.add(-1===o?i:i.substr(0,i.indexOf(".")))}return function(t,e){return d.includes(t)||"delete"===t&&e.includes("[")}(t,e)&&r.add("body"),r.size?[].concat(y(r)):[]}function w(t,e){var r=function(t){var e=t.replace(h,"'+params.$1+'").replace("[]","").replace(v,"'+params.body.$1+'");return new Function("params","return '"+e+"';")}(t);return function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];var o=e.reduce(function(t,e,r){return t[e]=n[r],t},{});return{url:r(o),params:o,restArgs:n.slice(e.length)}}}function O(t,e,r,n,i){var o=r.indexOf("[")>-1||["post","put","patch"].includes(e);n.length<i.length&&console.warn("For api call "+t+", "+e+", "+r+",\n         Expected parameters: "+i.join(", ")+"\n         Actual parameters: "+n.join(", ")+"\n      "),i.forEach(function(a,u){var s=c(n[u]);o&&u===i.length-1?"object"!==s&&console.warn(t+", "+e+", "+r+": Expected parameter "+a+" to be an object. Actual value: "+n[u]+" "+s):"string"!==s&&"number"!==s&&console.warn(t+", "+e+", "+r+": Expected parameter "+a+" to be a string or number. Actual value: "+n[u])})}var j,A=(function(t,e){!function(){var e=function t(e){var r,n="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element"),i=60103,o={use_static:!1};function a(t){var e=Object.getPrototypeOf(t);return e?Object.create(e):{}}function u(t,e,r){Object.defineProperty(t,e,{enumerable:!1,configurable:!1,writable:!1,value:r})}function c(t,e){u(t,e,function(){throw new m("The "+e+" method cannot be invoked on an Immutable data structure.")})}"object"!=typeof(r=e)||Array.isArray(r)||null===r||void 0!==e.use_static&&(o.use_static=Boolean(e.use_static));var s="__immutable_invariants_hold";function f(t){return"object"!=typeof t||null===t||Boolean(Object.getOwnPropertyDescriptor(t,s))}function l(t,e){return t===e||t!=t&&e!=e}function p(t){return!(null===t||"object"!=typeof t||Array.isArray(t)||t instanceof Date)}var y=["setPrototypeOf"],d=y.concat(["push","pop","sort","splice","shift","unshift","reverse"]),h=["keys"].concat(["map","filter","slice","concat","reduce","reduceRight"]),v=y.concat(["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"]);function m(t){this.name="MyError",this.message=t,this.stack=(new Error).stack}function b(t,e){for(var r in u(t,s,!0),e)e.hasOwnProperty(r)&&c(t,e[r]);return Object.freeze(t),t}function g(t,e){var r=t[e];u(t,e,function(){return K(r.apply(t,arguments))})}function w(t,e,r){var n=r&&r.deep;if(t in this&&(n&&this[t]!==e&&p(e)&&p(this[t])&&(e=K.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=S.call(this);return i[t]=K(e),A(i)}m.prototype=new Error,m.prototype.constructor=Error;var O=K([]);function j(t,e,r){var n=t[0];if(1===t.length)return w.call(this,n,e,r);var i,o=t.slice(1),a=this[n];if("object"==typeof a&&null!==a)i=K.setIn(a,o,e);else{var u=o[0];i=""!==u&&isFinite(u)?j.call(O,o,e):U.call(C,o,e)}if(n in this&&a===i)return this;var c=S.call(this);return c[n]=i,A(c)}function A(t){for(var e in h)h.hasOwnProperty(e)&&g(t,h[e]);o.use_static||(u(t,"flatMap",T),u(t,"asObject",I),u(t,"asMutable",S),u(t,"set",w),u(t,"setIn",j),u(t,"update",z),u(t,"updateIn",B),u(t,"getIn",N));for(var r=0,n=t.length;r<n;r++)t[r]=K(t[r]);return b(t,d)}function x(){return new Date(this.getTime())}function T(t){if(0===arguments.length)return this;var e,r=[],n=this.length;for(e=0;e<n;e++){var i=t(this[e],e,this);Array.isArray(i)?r.push.apply(r,i):r.push(i)}return A(r)}function P(t){if(void 0===t&&0===arguments.length)return this;if("function"!=typeof t){var e=Array.isArray(t)?t.slice():Array.prototype.slice.call(arguments);e.forEach(function(t,e,r){"number"==typeof t&&(r[e]=t.toString())}),t=function(t,r){return-1!==e.indexOf(r)}}var r=a(this);for(var n in this)this.hasOwnProperty(n)&&!1===t(this[n],n)&&(r[n]=this[n]);return Y(r)}function S(t){var e,r,n=[];if(t&&t.deep)for(e=0,r=this.length;e<r;e++)n.push(E(this[e]));else for(e=0,r=this.length;e<r;e++)n.push(this[e]);return n}function I(t){"function"!=typeof t&&(t=function(t){return t});var e,r={},n=this.length;for(e=0;e<n;e++){var i=t(this[e],e,this),o=i[0],a=i[1];r[o]=a}return Y(r)}function E(t){return!t||"object"!=typeof t||!Object.getOwnPropertyDescriptor(t,s)||t instanceof Date?t:K.asMutable(t,{deep:!0})}function k(t,e){for(var r in t)Object.getOwnPropertyDescriptor(t,r)&&(e[r]=t[r]);return e}function M(t,e){if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#merge can only be invoked with objects or arrays, not "+JSON.stringify(t));var r,n,i=Array.isArray(t),o=e&&e.deep,u=e&&e.mode||"merge",c=e&&e.merger;function s(t,n,i){var u,s=K(n[i]),f=c&&c(t[i],s,e),y=t[i];void 0===r&&void 0===f&&t.hasOwnProperty(i)&&l(s,y)||l(y,u=f||(o&&p(y)&&p(s)?K.merge(y,s,e):s))&&t.hasOwnProperty(i)||(void 0===r&&(r=k(t,a(t))),r[i]=u)}if(i)for(var f=0,y=t.length;f<y;f++){var d=t[f];for(n in d)d.hasOwnProperty(n)&&s(void 0!==r?r:this,d,n)}else{for(n in t)Object.getOwnPropertyDescriptor(t,n)&&s(this,t,n);"replace"===u&&function(t,e){for(var n in t)e.hasOwnProperty(n)||(void 0===r&&(r=k(t,a(t))),delete r[n])}(this,t)}return void 0===r?this:Y(r)}function _(t,e){var r=e&&e.deep;if(0===arguments.length)return this;if(null===t||"object"!=typeof t)throw new TypeError("Immutable#replace can only be invoked with objects or arrays, not "+JSON.stringify(t));return K.merge(this,t,{deep:r,mode:"replace"})}var D,F,R,C=K({});function U(t,e,r){if(!Array.isArray(t)||0===t.length)throw new TypeError('The first argument to Immutable#setIn must be an array containing at least one "key" string.');var n=t[0];if(1===t.length)return $.call(this,n,e,r);var i,o=t.slice(1),u=this[n];if(i=this.hasOwnProperty(n)&&"object"==typeof u&&null!==u?K.setIn(u,o,e):U.call(C,o,e),this.hasOwnProperty(n)&&u===i)return this;var c=k(this,a(this));return c[n]=i,Y(c)}function $(t,e,r){var n=r&&r.deep;if(this.hasOwnProperty(t)&&(n&&this[t]!==e&&p(e)&&p(this[t])&&(e=K.merge(this[t],e,{deep:!0,mode:"replace"})),l(this[t],e)))return this;var i=k(this,a(this));return i[t]=K(e),Y(i)}function z(t,e){var r=Array.prototype.slice.call(arguments,2),n=this[t];return K.set(this,t,e.apply(n,[n].concat(r)))}function q(t,e){for(var r=0,n=e.length;null!=t&&r<n;r++)t=t[e[r]];return r&&r==n?t:void 0}function B(t,e){var r=Array.prototype.slice.call(arguments,2),n=q(this,t);return K.setIn(this,t,e.apply(n,[n].concat(r)))}function N(t,e){var r=q(this,t);return void 0===r?e:r}function H(t){var e,r=a(this);if(t&&t.deep)for(e in this)this.hasOwnProperty(e)&&(r[e]=E(this[e]));else for(e in this)this.hasOwnProperty(e)&&(r[e]=this[e]);return r}function J(){return{}}function Y(t){return o.use_static||(u(t,"merge",M),u(t,"replace",_),u(t,"without",P),u(t,"asMutable",H),u(t,"set",$),u(t,"setIn",U),u(t,"update",z),u(t,"updateIn",B),u(t,"getIn",N)),b(t,y)}function K(t,e,r){if(f(t)||function(t){return"object"==typeof t&&null!==t&&(t.$$typeof===i||t.$$typeof===n)}(t)||function(t){return"undefined"!=typeof File&&t instanceof File}(t)||function(t){return"undefined"!=typeof Blob&&t instanceof Blob}(t)||function(t){return t instanceof Error}(t))return t;if(function(t){return"object"==typeof t&&"function"==typeof t.then}(t))return t.then(K);if(Array.isArray(t))return A(t.slice());if(t instanceof Date)return a=new Date(t.getTime()),o.use_static||u(a,"asMutable",x),b(a,v);var a,c=e&&e.prototype,s=(c&&c!==Object.prototype?function(){return Object.create(c)}:J)();if(null==r&&(r=64),r<=0)throw new m("Attempt to construct Immutable from a deeply nested object was detected. Have you tried to wrap an object with circular references (e.g. React element)? See https://github.com/rtfeldman/seamless-immutable/wiki/Deeply-nested-object-was-detected for details.");for(var l in r-=1,t)Object.getOwnPropertyDescriptor(t,l)&&(s[l]=K(t[l],void 0,r));return Y(s)}function W(t){return function(){var e=[].slice.call(arguments),r=e.shift();return t.apply(r,e)}}function G(t,e){return function(){var r=[].slice.call(arguments),n=r.shift();return Array.isArray(n)?e.apply(n,r):t.apply(n,r)}}return K.from=K,K.isImmutable=f,K.ImmutableError=m,K.merge=W(M),K.replace=W(_),K.without=W(P),K.asMutable=(D=H,F=S,R=x,function(){var t=[].slice.call(arguments),e=t.shift();return Array.isArray(e)?F.apply(e,t):e instanceof Date?R.apply(e,t):D.apply(e,t)}),K.set=G($,w),K.setIn=G(U,j),K.update=W(z),K.updateIn=W(B),K.getIn=W(N),K.flatMap=W(T),K.asObject=W(I),o.use_static||(K.static=t({use_static:!0})),Object.freeze(K),K}();t.exports=e}()}(j={exports:{}},j.exports),j.exports),x=A.static,T=(A.Immutable,x.from({data:void 0,error:null,isRequesting:!1,isErrored:!1})),P="error";var S,I="id",E="idProp",k="to",M="nestedProps";function _(t,e){for(var r=t[e],n=r&&e;r&&r[k];){if(r[E]||r[M])throw"'"+k+"' aliases cannot be used with '"+E+"' and '"+M+"' properties";n=r[k],r=t[r[k]]}return{entityType:n,rule:r}}var D=(f(S={entityType:"string"},E,"string?"),f(S,k,"string?"),f(S,M,"string{}?"),S),F=/(\{\})?(\??)$/,R=function(t,e){return t.every(function(t){var r=new Set([].concat(y(Object.keys(D)),y(Object.keys(t))));return Array.from(r).every(function(r){var n=e[r];if(void 0!==n){var i,o=n.split(F),a=(i=o,Array.isArray(i)?i:Array.from(i)),u=a[0],s=a.slice(1),f=s.indexOf("?")>-1,l=s.indexOf("{}")>-1,p=t[r],y=void 0===p?"undefined":c(p);return!(!f||void 0!==p)||(l?"object"===y&&Object.values(p).every(function(t){return(void 0===t?"undefined":c(t))===u}):void 0!==p&&(void 0===y?"undefined":c(y))===u)}})})},C=void 0,U=void 0,$=void 0;function z(t){if(C&&t===U&&t.length===$)return C;if(!R(t,D))throw"Error: rules do not match schema";return C=t.reduce(function(t,e){return t[e.entityType]=e,t},{}),U=t,$=t.length,C}t.makeActionCreator=function(t,o,a){var u=this,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},f=g(o,a);c.debug&&function(t,e,r,n){console.log("Created action "+t+", "+r+", "+e+"("+n.join(", ")+")")}(t,o,a,f);var p=void 0,d=l({},m),h=l({},b),v=w(a,f),j=function(){for(var e=arguments.length,l=Array(e),m=0;m<e;m++)l[m]=arguments[m];return b=s(regeneratorRuntime.mark(function e(s){var m,b,g,w,j,A,x,T,P,S;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c.debug&&O(t,o,a,l,f),m=v.apply(void 0,l),b=m.url,g=m.params,w=m.restArgs,j={type:r(t),meta:{entityType:t,method:o}},j=d.start(j,g,w,c),j=d.all(j,g,w,c),s(j),e.prev=6,A=void 0,x=void 0,void 0!==p&&(A="function"==typeof p?p.apply(void 0,l):p,(x=void 0===A?void 0:{body:A})&&console.info("Mocking "+o+" "+a,A)),e.t0=x,e.t0){e.next=14;break}return e.next=13,h.apiFetch.apply(h,[o,b,g.body].concat(y(w)));case 13:e.t0=e.sent;case 14:return x=e.t0,T={type:n(t),payload:x&&x.body,meta:{entityType:t,method:o}},T=d.success(T,g,w,c,x),T=d.all(T,g,w,c,x),P=T.payload,s(T),e.abrupt("return",P);case 23:throw e.prev=23,e.t1=e.catch(6),S={type:i(t),payload:e.t1,error:!0,meta:{entityType:t,method:o}},S=d.error(S,g,w,c,e.t1),S=d.all(S,g,w,c,e.t1),s(S),e.t1;case 30:case"end":return e.stop()}},e,u,[[6,23]])})),function(t){return b.apply(this,arguments)};var b};return e(j,d),j.apiFetch=function(t){return h.apiFetch=t,j},j.mock=function(t){return p=t,j},j.unmock=function(){return p=void 0,j},j},t.makeReducer=function(t,o){var a={start:function(t,e,r,n){return t},success:function(t,e,r,n){return t},error:function(t,e,r,n){return t},all:function(t,e,r,n){return t},default:function(t,e,r){return t}},u=r(t),c=n(t),s=i(t),p=o&&o.errorKey||P,y=p===P?T:y=x.from(l({},x.without(T,"error"),f({},p,null))),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,r=arguments[1],n=void 0;switch(r.type){case u:return n=l({},e,f({isRequesting:!0,isErrored:!1},p,null)),n=a.start(n,e,r,o),n=a.all(n,e,r,o),x.from(n);case c:return n=l({},e,{data:r.payload,isRequesting:!1,isErrored:!1}),n=a.success(n,e,r,o),n=a.all(n,e,r,o),x.from(n);case s:return n=l({},e,f({isRequesting:!1,isErrored:!0},p,r.payload)),n=a.error(n,e,r,o),n=a.all(n,e,r,o),x.from(n);case t+".set":var i=["data"];return r.meta.path&&(i=i.concat(r.meta.path)),x.setIn(e,i,r.payload);case"grim.reset":var d=r.payload,h=d.includes,v=d.excludes;if(h){if(h.includes(t))return y}else if(!v||!v.includes(t))return y;default:return n=a.default?a.default(e,r,o):n,x.from(n)}};return e(d,a),d.modifyInitialState=function(t){return y=t(y),d},d},t.setAction=function(t,e,r){return{type:o(t),payload:e,meta:{entityType:t,path:r}}},t.resetAction=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.includes;return{type:"grim.reset",payload:{excludes:t.excludes,includes:e}}},t.createSelector=function(t,e,r,n){var i=z(t);if(!i[r])throw"Key not found "+r;var o=[].concat(y(new Set(function t(e,r){var n=_(e,r),i=n.rule,o=n.entityType,a=o&&[o];if(i&&i[M]){var u=!0,c=!1,s=void 0;try{for(var f,l=Object.values(i[M])[Symbol.iterator]();!(u=(f=l.next()).done);u=!0){var p=f.value;a=[].concat(y(a),y(t(e,p)))}}catch(t){c=!0,s=t}finally{try{!u&&l.return&&l.return()}finally{if(c)throw s}}}return a}(i,r)))),a=[function(t){var e=n(t);return e&&"object"===(void 0===e?"undefined":c(e))&&"data"in e?e.data:e}].concat(y(o.map(function(t){return function(r){return e(r)[t]}}))),u=void 0,s=void 0;return function(t){var n,o,f=a.map(function(e){return e(t)});return(n=f)===(o=u)||n&&o&&n.length===o.length&&n.every(function(t,e){return t===o[e]})||(u=f,s=x.from(function t(e,r,n,i){if(!n)return n;var o=_(e,r),a=o.rule,u=o.entityType;if(Array.isArray(n))return n.map(function(r){return t(e,u,r,i)});if("object"===(void 0===n?"undefined":c(n)))return Object.entries(n).reduce(function(r,n){var o=p(n,2),a=o[0],c=o[1];return r[a]=t(e,u,c,i),r},{});var s=i[u]&&i[u][n];if(!s)return n;var f=l({},s);if(a[M]){var y=!0,d=!1,h=void 0;try{for(var v,m=Object.entries(a[M])[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){var b=v.value,g=p(b,2),w=g[0],O=g[1];f[w]=t(e,O,f[w],i)}}catch(t){d=!0,h=t}finally{try{!y&&m.return&&m.return()}finally{if(d)throw h}}}return f}(i,r,f[0],e(t)))),s}},t.normalizationReducer=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1].meta;if(e&&"delete"===e.method&&e.id)return x.set(t,e.entityType,x.without(t[e.entityType],e.id));if(e&&e.entities&&"object"===c(e.entities)){var r=t;return Object.keys(e.entities).forEach(function(n){return r=x.set(r,n,x.merge({},[t[n],e.entities[n]]))}),r}return t},t.getNormalizerMiddleware=function(t,e){var r=z(t);return function(){return function(t){return function(n){if(a(n.type)||u(n.type)){var i=n.payload,o=n.meta,s=o&&o.entityType;s&&i&&r[s]&&(o.entities={},n.payload=function t(e,r,n,i){if(!e[r])throw"Unrecognised entityType: "+r;var o=_(e,r),a=o.rule,u=o.entityType;if(Array.isArray(n))return n.map(function(r){return t(e,u,r,i)});if(!n||"object"!==(void 0===n?"undefined":c(n)))return n;var s=n[a[E]||I];if(!s)return Object.entries(n).reduce(function(r,n){var o=p(n,2),a=o[0],c=o[1];return r[a]=t(e,u,c,i),r},{});var f=l({},n);if(i[u]=i[u]||{},i[u][s]=f,a[M]){var y=!0,d=!1,h=void 0;try{for(var v,m=Object.entries(a[M])[Symbol.iterator]();!(y=(v=m.next()).done);y=!0){var b=v.value,g=p(b,2),w=g[0],O=g[1];f[w]=t(e,O,n[w],i)}}catch(t){d=!0,h=t}finally{try{!y&&m.return&&m.return()}finally{if(d)throw h}}}return s}(r,s,i,o.entities),e&&e(s,i))}return t(n)}}}},t.processRules=z,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=redux-grim.min.js.map
